# mysql-bash-partitioning
Скрипт для автоматического создания партиций по дням в MySQL 5.6+ для Zabbix v3.2 и выше.

# Описание
После каждой установки Zabbix, лучше сразу провести партиционирование таблиц с данными истории для более гибкого управления.

Скрипт создаёт:
- партиции по дням как для таблиц с уже существующими данными, так и для пустых;
- таблицы в MySQL для управления партициями;
- заполняет таблицы информацией для хранения партиций согласно значениям из переменных;
- создаёт процедуры MySQL по созданию и удалению партиций;
- создаёт планировщик для автоматического запуска.

# Таблицы, подлежащие партиционированию:
history
history_uint
history_str
history_text
history_log
trends
trends_uint

# Требования для успешного выполнения скрипта
0) Доступ в MySQL без ввода пароля для пользователя, от которого будет запускаться скрипт (или же поправить в самом скрипте доступ)
1) Возможность записи в директорию /tmp для хранения промежуточных данных с SQL-запросами
2) Заполненные переменные history_..._cnt и trends_cnt для нужного времени хранения партиций каждой партиционируемой таблицы. По умолчанию значения уже заданы, подлежат изменению
3) Включенный планировщик в my.cnf или через SET GLOBAL event_scheduler = ON (надо прописать в конфиг);
4) Заполненная переменная evnt_start с датой и временем запуска планировщика в MySQL. По умолчанию также уже заполнена.

# После выполнения скрипта
Отключить хаускипер в веб-интерфейсе забикса для истории и динамики изменений.

# Примечания
Не забывайте сделать бэкап всего и вся! Перед выполнением стоит понимать, что такое партиции и как они создаются. Моя статья по ручному созданию партиций с комментариями: https://rmn-lux.ru/mysql-%d0%bf%d0%b0%d1%80%d1%82%d0%b8%d1%86%d0%b8%d0%be%d0%bd%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-%d1%82%d0%b0%d0%b1%d0%bb%d0%b8%d1%86-zabbix/
